name: Quick Docker Test

# Workflow rapide pour les tests sur chaque push
on:
  push:
    paths:
      - 'Dockerfile*'
      - 'docker-compose.yml'
      - '.dockerignore'
      - 'package*.json'
      - 'src/**'

jobs:
  quick-test:
    runs-on: ubuntu-latest
    
    steps:
      - name: 📥 Checkout
        uses: actions/checkout@v4

      - name: 🐳 Setup Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: 🔧 Test Build rapide
        run: |
          # Build rapide sans cache pour vérifier la syntaxe
          docker build -t quick-test .
          
          # Test de démarrage rapide
          docker run -d --name quick-test-container -p 3000:3000 quick-test
          sleep 5
          
          # Vérification simple
          docker ps | grep quick-test-container
          docker logs quick-test-container
          
          # Nettoyage
          docker stop quick-test-container
          docker rm quick-test-container

      - name: 🔧 Setup Docker Compose
        run: |
          # Vérifie quelle version de Docker Compose est disponible
          if command -v docker-compose &> /dev/null; then
            echo "DOCKER_COMPOSE=docker-compose" >> $GITHUB_ENV
          else
            echo "DOCKER_COMPOSE=docker compose" >> $GITHUB_ENV
          fi

      - name: ✅ Validation Docker Compose
        run: |
          ${{ env.DOCKER_COMPOSE }} config --quiet
