# Dockerfile pour le développement avec hot reload
FROM node:20-alpine

# Définit le répertoire de travail dans le conteneur
WORKDIR /app

# Copie les fichiers package.json et package-lock.json
COPY package*.json ./

# Installe toutes les dépendances (y compris dev)
RUN npm ci && npm cache clean --force

# Copie le code source
COPY . .

# Expose le port 3000
EXPOSE 3000

# Crée un utilisateur non-root pour la sécurité
RUN addgroup -g 1001 -S nodejs
RUN adduser -S nestjs -u 1001

# Change le propriétaire des fichiers
RUN chown -R nestjs:nodejs /app
USER nestjs

# Commande pour démarrer l'application en mode développement
CMD ["npm", "run", "start:dev"]
